<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸŽ‰Year End Event Lucky Draw</title>

<style>
  /* Reset & base */
  body, html {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f4f8;  /* Light bluish-gray */
  color: #222;          /* Dark text for contrast */
  overflow-x: hidden;
}


  #particles-js {
    position: fixed;
    width: 100%; height: 100%;
    top: 0; left: 0;
    z-index: -1;
  }

  /* Container for everything */
  .container {
    max-width: 600px;
    margin: 25px auto 40px;
    text-align: center;
  }

  h2 {
    user-select: none;
    font-weight: 700;
    font-size: 2.5rem;
    margin-bottom: 20px;
  }

  /* Upload area */
  #upload-area {
    display: inline-flex;
    gap: 10px;
    margin-bottom: 40px;
  }

  input[type="file"] {
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    cursor: pointer;
  }

  button#upload-btn {
    background-color: #43a047;
    border: none;
    color: white;
    padding: 10px 25px;
    font-size: 16px;
    border-radius: 7px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  button#upload-btn:hover {
    background-color: #388e3c;
  }

  button#spin-btn {
    background-color: #f4511e;
    border: none;
    color: white;
    padding: 12px 36px;
    font-size: 20px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    margin-top: 30px;
    transition: background-color 0.3s ease;
  }
  button#spin-btn:hover {
    background-color: #d84315;
  }

  /* Wheel container */
  #wheel-container {
    position: relative;
    margin: 0 auto;
    width: 520px;
    height: 520px;
    background: radial-gradient(circle at center, #42a5f5, #26a69a);
    border-radius: 50%;
    box-shadow: 0 16px 50px rgba(0, 0, 0, 0.5);
  }

  /* Downward pointer */
  #pointer {
    width: 0; height: 0;
    border-left: 26px solid transparent;
    border-right: 26px solid transparent;
    border-bottom: 40px solid #e53935;
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
    user-select: none;
    z-index: 10;
  }

  /* Center box with name/email */
  #center-box {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255 255 255 / 0.95);
    padding: 30px 50px;
    border-radius: 20px;
    min-width: 360px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.25);
    user-select: none;
    text-align: center;
    color: #222;
  }

  #center-name {
    font-weight: 700;
    font-size: 32px;
    letter-spacing: 0.06em;
    margin-bottom: 10px;
  }

  #center-email {
    font-weight: 500;
    font-size: 20px;
    color: #555;
    word-break: break-word;
  }

  /* Company logo */
  #logo {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    opacity: 0.9;
    user-select: none;
  }
</style>
</head>
<body>

<div id="particles-js"></div>

<div class="container">
  <h1>ðŸŽ‰Year End Event Lucky DrawðŸŽ‰</h1>

  <div id="upload-area">
    <input type="file" id="fileInput" accept=".xlsx, .xls" />
    <button id="upload-btn" onclick="upload()">Boost Me</button>
  </div>

  <div id="wheel-container">
    <div id="pointer"></div>
   <div id="center-box">
  <div id="winner-label" style="display:none; font-weight:700; font-size:22px; color:#e53935; margin-bottom:8px;">WINNER</div>
  <div id="center-name">READY</div>
  <div id="center-email"></div>
</div>


    <img id="logo" src="/static/logo.png" alt="Company Logo" />
  </div>

  <button id="spin-btn" onclick="spin()">SPIN</button>
</div>

<!-- Particles.js library -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<!-- Confetti library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
  // Initialize particles.js background
  particlesJS("particles-js", {
    "particles": {
      "number": {"value": 90},
      "color": {"value": "#ffffff"},
      "shape": {"type": "circle"},
      "opacity": {"value": 0.75},
      "size": {"value": 3},
      "line_linked": {"enable": true, "distance": 140, "color": "#ffffff", "opacity": 0.15, "width": 1},
      "move": {"enable": true, "speed": 2.5}
    },
    "interactivity": {
      "detect_on": "canvas",
      "events": {
        "onhover": {"enable": true, "mode": "grab"},
        "onclick": {"enable": true, "mode": "push"}
      },
      "modes": {"grab": {"distance": 180, "line_linked": {"opacity": 0.6}}, "push": {"particles_nb": 4}}
    },
    "retina_detect": true
  });

  let participants = [];
  let spinning = false;

  // Utility: Sleep function for async delays
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Upload and parse Excel, filter attendees with "Yes"
  async function upload() {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];
    if (!file) {
      alert("Please choose an Excel file to upload.");
      return;
    }

    try {
      // Read Excel with SheetJS library (load from CDN)
      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet);

      // Filter participants where "Are you attending the Year End Event?" is "Yes"
      participants = jsonData
        .filter(row => String(row["Are you attending the Year End Event?"]).toLowerCase() === "yes")
        .map(row => ({
          name: row["Your full name."] || row["Name"] || "No Name",
          email: row["Your PS Email ID (XYZ@abc.com)."] || row["Email"] || "No Email"
        }));

      if (participants.length === 0) {
        alert("No participants marked as attending found.");
        return;
      }

      // Update UI
      document.getElementById("center-name").textContent = `${participants.length} Participants Loaded`;
      document.getElementById("center-email").textContent = "";

    } catch (error) {
      console.error(error);
      alert("Failed to parse Excel file. Please check the file and try again.");
    }
  }

  // Spin function - cycle names, then show winner with confetti
  async function spin() {
  if (spinning) return;
  if (participants.length === 0) {
    alert("Please upload a valid Excel with participants first.");
    return;
  }

  spinning = true;

  const nameBox = document.getElementById("center-name");
  const emailBox = document.getElementById("center-email");
  const winnerLabel = document.getElementById("winner-label");

  // Hide winner label during spinning
  winnerLabel.style.display = "none";

  const spinDuration = 6000; // total spin time ms
  const intervalMs = 90; // speed of cycling
  let elapsed = 0;
  let idx = 0;

  // Cycle names quickly
  while (elapsed < spinDuration) {
    const randomIndex = Math.floor(Math.random() * participants.length);
    const p = participants[randomIndex];
    nameBox.textContent = p.name;
    emailBox.textContent = p.email;
    await new Promise(r => setTimeout(r, intervalMs));
    elapsed += intervalMs;
}

  // Pick random winner
  const winner = participants[Math.floor(Math.random() * participants.length)];
  nameBox.textContent = winner.name;
  emailBox.textContent = winner.email;

  // Show WINNER label now
  winnerLabel.style.display = "block";

  // Trigger confetti celebration
  celebrateConfetti();

  spinning = false;
}

  // Confetti inside wheel area
  function celebrateConfetti() {
    const wheel = document.getElementById("wheel-container");
    const rect = wheel.getBoundingClientRect();

    const duration = 4000;
    const end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 5,
        angle: 60,
        spread: 55,
        origin: { x: (rect.left + rect.width / 2) / window.innerWidth, y: (rect.top + rect.height / 2) / window.innerHeight }
      });
      confetti({
        particleCount: 5,
        angle: 120,
        spread: 55,
        origin: { x: (rect.left + rect.width / 2) / window.innerWidth, y: (rect.top + rect.height / 2) / window.innerHeight }
      });

      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();
  }

</script>

<!-- SheetJS library for Excel parsing -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

</body>
</html>
